<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2024 Roots & Wings Festival</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- style.css content starts here --- */
        body {
            font-family: 'Roboto Slab', serif;
            background-color: #e9ecef;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 10px;
            box-sizing: border-box;
        }

        .container {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            width: 100%;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .logo {
            display: block;
            margin: 0 auto 20px auto;
            max-width: 250px;
            width: 100%;
            height: auto;
        }

        .app-title-logo-text {
            color: #ef8c2a;
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 8px;
            display: block;
        }

        .section-header {
            color: #33232b;
            font-size: 1.8em;
            font-weight: 600;
        }

        .festival-date-text {
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
            color: #33232b;
            font-size: 0.95em;
        }

        .search-section {
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .search-section label {
            font-size: 1em;
            color: #495057;
            margin-bottom: 3px;
            font-weight: 500;
        }

        .search-section input[type="text"],
        .search-section select,
        .search-section input[type="date"] {
            font-family: 'Roboto Slab', serif;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 7px;
            width: 95%;
            max-width: 300px;
            font-size: 1em;
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            height: auto;
            min-height: 38px;
        }

        .search-section input[type="text"]:focus,
        .search-section select:focus,
        .search-section input[type="date"]:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
            outline: none;
        }

        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            justify-content: center;
            width: 100%;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .search-section button {
            font-family: 'Roboto Slab', serif;
            padding: 12px 25px;
            border: none;
            border-radius: 7px;
            cursor: pointer;
            font-size: 1.05em;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-sizing: border-box;
            width: 95%;
            max-width: 280px;
            margin: 0 auto;
        }

        .search-button {
            background-color: #ef8c2a;
            color: white;
        }

        .search-button:hover {
            background-color: #d17a25;
            transform: translateY(-2px);
        }

        .search-button:active {
            background-color: #b36920;
            transform: translateY(0);
        }

        .reset-button {
            background-color: #33232b;
            color: white;
        }

        .reset-button:hover {
            background-color: #2b1e24;
            transform: translateY(-2px);
        }

        .reset-button:active {
            background-color: #24181f;
            transform: translateY(0);
        }

        .show-all-events {
            font-size: 1em;
            color: #ef8c2a;
            cursor: pointer;
            text-decoration: underline;
            margin-top: 5px;
            margin-bottom: 15px;
        }

        .show-all-events:hover {
            color: #d17a25;
        }

        .events-display {
            text-align: left;
            border-top: 1px solid #e9ecef;
            padding-top: 20px;
            margin-top: 20px;
            position: relative;
        }

        .events-found-count {
            font-size: 1em;
            font-weight: bold;
            color: #212529;
            margin-bottom: 10px;
        }

        .event-card {
            background-color: #f8f9fa;
            border: 1px solid #e2e6ea;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s ease;
        }

        .event-card:hover {
            transform: translateY(-3px);
        }

        .event-card h3 {
            color: #ef8c2a;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.4em;
        }

        .event-card h3 a {
            color: #ef8c2a;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .event-card h3 a:hover {
            color: #d17a25;
            text-decoration: underline;
        }

        .event-card p {
            margin: 5px 0;
            color: #555;
            line-height: 1.5;
            font-size: 0.95em;
        }

        /* Styling for the date and location text */
        .event-card p strong {
            color: #33232b;
            font-weight: 600;
        }

        .event-card p a {
            color: #ef8c2a;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .event-card p a:hover {
            color: #d17a25;
            text-decoration: underline;
        }
        
        /* Styling for the new description field */
        .event-description {
            color: #BFBFBF; /* Updated to a grayer color */
            font-style: normal; /* No longer italic */
            line-height: 1.4;
            margin-top: 10px;
            /* Truncation styles */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
        }

        .event-description.expanded {
            white-space: normal;
            overflow: visible;
            text-overflow: clip;
        }

        .event-card .themes-list {
            font-size: 0.85em;
            color: #adb5bd;
            margin-top: 8px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .no-results-message {
            color: #ef8c2a;
            font-weight: bold;
            margin-top: 20px;
            font-size: 1em;
        }

        .initial-message {
            color: #868e96;
            font-style: italic;
            text-align: center;
            font-size: 1em;
            padding: 10px;
            border: 1px dashed #ced4da;
            border-radius: 5px;
            background-color: #f2f4f6;
        }

        .back-to-top-link {
            text-align: center;
            margin-top: 20px;
            font-size: 1em;
            color: #ef8c2a;
            cursor: pointer;
            text-decoration: underline;
            display: none; /* Hidden by default */
        }

        .back-to-top-link:hover {
            color: #d17a25;
        }

        /* Desktop and Tablet styles (min-width for progressive enhancement) */
        @media (min-width: 480px) {
            body {
                margin: 20px;
            }
            .container {
                padding: 30px;
            }
            .app-title-logo-text {
                font-size: 2.2em;
            }
            .section-header {
                font-size: 2em;
            }
            .festival-date-text {
                font-size: 1em;
            }
            .search-section {
                gap: 15px;
            }
            .search-section label {
                font-size: 1.1em;
            }
            .search-section input[type="text"],
            .search-section select,
            .search-section input[type="date"] {
                padding: 14px;
                font-size: 1.05em;
                min-height: 40px;
            }
            .button-group {
                flex-direction: row;
                gap: 15px;
            }
            .search-section button {
                width: auto;
                max-width: none;
                padding: 14px 30px;
                font-size: 1.1em;
            }
            .show-all-events {
                font-size: 1.05em;
                margin-top: 10px;
                margin-bottom: 20px;
            }
            .events-display {
                padding-top: 25px;
                margin-top: 25px;
            }
            .events-found-count {
                font-size: 1.05em;
                margin-bottom: 15px;
            }
            .event-card {
                padding: 20px;
                margin-bottom: 20px;
            }
            .event-card h3 {
                font-size: 1.5em;
            }
            .event-card p {
                font-size: 1em;
            }
            .event-card .themes-list {
                font-size: 0.9em;
            }
            .no-results-message {
                margin-top: 25px;
                font-size: 1.05em;
            }
            .initial-message {
                font-size: 1.05em;
                padding: 15px;
            }
        }

        @media (min-width: 768px) {
            .container {
                padding: 35px;
                max-width: 650px;
            }
            .app-title-logo-text {
                font-size: 2.5em;
            }
            .section-header {
                font-size: 2.2em;
            }
            .festival-date-text {
                font-size: 1.1em;
            }
            .search-section {
                gap: 18px;
            }
            .search-section input[type="text"],
            .search-section select,
            .search-section input[type="date"] {
                max-width: 280px;
                font-size: 1.1em;
            }
            .search-section button {
                font-size: 1.15em;
            }
            .show-all-events {
                font-size: 1.1em;
            }
            .events-found-count {
                font-size: 1.1em;
            }
            .event-card h3 {
                font-size: 1.6em;
            }
            .event-card p {
                font-size: 1.05em;
            }
            .event-card .themes-list {
                font-size: 0.95em;
            }
            .no-results-message {
                font-size: 1.1em;
            }
            .initial-message {
                font-size: 1.1em;
            }
        }
        /* --- style.css content ends here --- */
    </style>
</head>
<body>
    <div class="container">
        <span class="app-title-logo-text">2025 Roots & Wings Festival</span>
        <h1 class="section-header">Find Events</h1>
        <p class="festival-date-text">Saturday, October 18th - Sunday, November 2, 2025</p>

        <div class="search-section">
            <label for="keywordOrZipInput">Search by Keyword or Zip Code:</label>
            <input type="text" id="keywordOrZipInput" placeholder="e.g., Garden or 78701">

            <label for="eventDateInput">Search by Date:</label>
            <input type="date" id="eventDateInput" min="2024-10-01" max="2024-11-30">

            <label for="themeSelect">Search by theme:</label>
            <select id="themeSelect" multiple>
                <option value="">All Themes</option>
                <!-- Options will be populated by JavaScript -->
            </select>
            <div class="button-group">
                <button id="searchButton" class="search-button">Search Events</button>
                <button id="resetButton" class="reset-button">Reset</button>
            </div>
            <p id="showAllEventsText" class="show-all-events">Or show me all events</p>
        </div>
        
        <div id="eventsDisplay" class="events-display">
            <p class="initial-message">Enter a date, zip code, or keyword, or select a theme, then click "Search Events" to find local happenings.</p>
        </div>

        <div id="noResultsMessage" class="no-results-message" style="display: none;">
            <p>No events found matching your criteria. Please try another search!</p>
        </div>
        
        <p id="backToTopLink" class="back-to-top-link">Back to top</p>
    </div>

    <script>
        // --- script.js content starts here ---
        // Function to convert theme names to camelCase for object keys
        const toCamelCase = (name) => {
            return name
                .replace(/[^a-zA-Z0-9 ]/g, '')
                .replace(/(?:^\w|[A-Z]|\b\w)/g, (word, index) => {
                    return index === 0 ? word.toLowerCase() : word.toUpperCase();
                })
                .replace(/\s+/g, '');
        };

        // Raw data from Roots_and_Wings_Sample_Data.csv
        const rawEventData = `Event Title,Full DateTime,Event Location,Full Address,Food Equity,It's My Park Day,Bats,Birds,Fungi,Kids: Ages 0-5,Kids: Ages 5-12,Library,Sensory-Friendly,Teens: Ages 12-17,Cultural,Beautification,Indoors,Adults,All Ages,En EspaÃ±ol,Pollinators,Soil Health/Plants,Trees,Museum,STEM,Event Link,Address,City,State,Zip Code
Blossoms & Bugs: Adelphi Acre Community Garden Festival!,10/19/2024 10:00 AM,Adelphi Acre Community Garden,"3701 Adelphi Ln, Austin, TX,78759",1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,https://rootsandwingsfest.com/schedule/blossoms-bugs-adelphi-acre-community-garden-festival,3701 Adelphi Ln,Austin,TX,78759
Beautify the Austin Nature & Science Center: a Roots & Wings Festival and It's My Park Day Crossover Event!,11/2/2024 10:00 AM,Austin Nature & Science Center,"2389 Stratford Dr, Austin, TX,78746",0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,1,0,0,https://rootsandwingsfest.com/schedule/buzz-flutter-and-grow-with-the-austin-nature-science-center-6t243,2389 Stratford Dr,Austin,TX,78746
Bats, Bats, Bats!,10/26/2024 10:00 AM,South Lamar Branch Library,"3260 S Lamar Blvd, Austin, TX,78704",0,0,1,0,0,1,1,1,0,0,0,1,1,0,0,0,0,1,0,0,1,https://rootsandwingsfest.com/schedule/bats-bats-bats,3260 S Lamar Blvd,Austin,TX,78704
Urban Forest Explorers: Nature Play at APL!,10/26/2024 10:00 AM,Rundberg Branch Library,"835 W Rundberg Ln, Austin, TX,78758",0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,0,https://rootsandwingsfest.com/schedule/urban-forest-explorers-nature-play-at-apl,835 W Rundberg Ln,Austin,TX,78758
Un-BEE-Lievable Pollinators Festival!,10/26/2024 10:00 AM,Windsor Park Branch Library,"5833 Westminster Dr, Austin, TX,78723",0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,https://rootsandwingsfest.com/schedule/un-bee-lievable-pollinators-festival,5833 Westminster Dr,Austin,TX,78723
Preschool Imagination Station: Roots & Wings!,10/24/2024 10:00 AM,Hampton Branch at Oak Hill Library,"5125 Convict Hill Rd, Austin, TX,78749",0,0,1,0,1,1,0,1,0,0,0,0,1,0,0,1,1,1,1,0,0,https://rootsandwingsfest.com/schedule/preschool-imaginaton-station-roots-wings2,5125 Convict Hill Rd,Austin,TX,78749
Roots and Wings Festival at Oak Hill Library!,10/19/2024 10:00 AM,Hampton Branch at Oak Hill Library,"5125 Convict Hill Rd, Austin, TX,78749",0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,1,1,0,0,0,https://rootsandwingsfest.com/schedule/roots-and-wings-festival-at-oak-hill-library,5125 Convict Hill Rd,Austin,TX,78749
Butterfly Festival with Author Tracy Dockray!,10/24/2024 10:00 AM,Southeast Branch Library,"5803 Nuckols Crossing Rd, Austin, TX,78744",0,0,0,0,0,0,0,1,1,0,0,0,1,0,1,0,1,0,0,0,0,https://rootsandwingsfest.com/schedule/butterfly-festival-with-author-tracy-dockray3,5803 Nuckols Crossing Rd,Austin,TX,78744
Preschool Imagination Station: Roots & Wings!,10/28/2024 10:00 AM,Yarborough Branch Library,"2200 Hancock Dr, Austin, TX,78756",0,0,1,0,1,1,0,1,1,0,0,0,1,0,0,0,1,1,1,0,0,https://rootsandwingsfest.com/schedule/preschool-imagination-station-roots-wings,2200 Hancock Dr,Austin,TX,78756`;

        // Placeholder description text
        const placeholderDescription = 'orem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem.';

        const parseEventData = (dataString) => {
            const lines = dataString.trim().split('\n');
            if (lines.length === 0) return [];

            const headerLine = lines[0];
            const header = headerLine.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g).map(h => h.replace(/"/g, '').trim());
            const themeStartIndex = header.indexOf("Food Equity");

            const parsedEvents = [];

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i];
                const values = line.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g).map(v => v.replace(/"/g, '').trim());

                if (values.length !== header.length) {
                    console.warn(`Skipping malformed row ${i + 1}: Expected ${header.length} columns, got ${values.length}. Line: ${line}`);
                    continue;
                }

                const event = {};
                const themes = {};

                for (let j = 0; j < header.length; j++) {
                    const key = header[j];
                    const value = values[j];

                    if (j >= themeStartIndex && themeStartIndex !== -1 && j < header.indexOf("Event Link")) {
                        const themeCamelCase = toCamelCase(key);
                        themes[themeCamelCase] = value === '1';
                    } else {
                        if (key === "Event Title") {
                            event.name = value;
                        } else if (key === "Full DateTime") {
                            const dateObj = new Date(value);
                            if (isNaN(dateObj.getTime())) {
                                event.displayDate = '';
                                event.timestamp = null;
                            } else {
                                const options = { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true };
                                event.displayDate = dateObj.toLocaleString('en-US', options);
                                event.timestamp = dateObj;
                            }
                        } else if (key === "Event Location") {
                            event.location = value;
                        } else if (key === "Address") {
                            event.address = value;
                        } else if (key === "City") {
                            event.city = value;
                        } else if (key === "State") {
                            event.state = value;
                        } else if (key === "Zip Code") {
                            event.zipCode = value;
                        } else if (key === "Event Link") {
                            event.url = value;
                        } else {
                            event[toCamelCase(key)] = value;
                        }
                    }
                }
                event.themes = themes;
                parsedEvents.push(event);
            }
            return parsedEvents;
        };

        document.addEventListener('DOMContentLoaded', () => {
            const keywordOrZipInput = document.getElementById('keywordOrZipInput');
            const eventDateInput = document.getElementById('eventDateInput');
            const themeSelect = document.getElementById('themeSelect');
            const searchButton = document.getElementById('searchButton');
            const resetButton = document.getElementById('resetButton');
            const eventsDisplay = document.getElementById('eventsDisplay');
            const noResultsMessage = document.getElementById('noResultsMessage');
            const showAllEventsText = document.getElementById('showAllEventsText');
            const backToTopLink = document.getElementById('backToTopLink');

            // Define the theme names in the new specific order
            const themeNames = [
                "Trees",
                "Adults",
                "Age: 0-5",
                "Age: 5-12",
                "Age: 12-17",
                "All Ages",
                "Bats",
                "Birds",
                "Cultural",
                "En EspaÃ±ol",
                "Food Equity",
                "Fungi",
                "Indoors",
                "Library",
                "Pollinators",
                "Sensory-Friendly",
                "Soil Health/Plants",
                "STEM"
            ];
            
            // Populate the theme dropdown
            themeNames.forEach(theme => {
                const option = document.createElement('option');
                option.value = toCamelCase(theme);
                option.textContent = theme === 'Trees' ? 'Trees ðŸŒ³' : theme;
                themeSelect.appendChild(option);
            });

            const allEvents = parseEventData(rawEventData);

            // Function to display events
            const displayEvents = (eventsToDisplay) => {
                eventsDisplay.innerHTML = '';
                noResultsMessage.style.display = 'none';
                backToTopLink.style.display = 'none';

                if (eventsToDisplay.length > 0) {
                    backToTopLink.style.display = 'block';
                    const eventsCountElement = document.createElement('p');
                    eventsCountElement.classList.add('events-found-count');
                    eventsCountElement.textContent = `${eventsToDisplay.length} event${eventsToDisplay.length === 1 ? '' : 's'} found:`;
                    eventsDisplay.appendChild(eventsCountElement);
                    eventsToDisplay.forEach(event => {
                        const eventCard = document.createElement('div');
                        eventCard.classList.add('event-card');
                        
                        const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(`${event.address}, ${event.city}, ${event.state} ${event.zipCode}`)}`;

                        eventCard.innerHTML = `
                            <h3><a href="${event.url}" target="_blank">${event.name}</a></h3>
                            ${event.displayDate ? `<p><strong>Date:</strong> ${event.displayDate}</p>` : ''}
                            <p><strong>Location:</strong> <a href="${mapUrl}" target="_blank">${event.location}, ${event.address}, ${event.zipCode}</a></p>
                            <p class="event-description"><strong>Description: </strong>${placeholderDescription}</p>
                        `;
                        eventsDisplay.appendChild(eventCard);

                        // Add click event to expand description
                        const descriptionElement = eventCard.querySelector('.event-description');
                        descriptionElement.addEventListener('click', () => {
                            descriptionElement.classList.toggle('expanded');
                        });
                    });
                } else {
                    noResultsMessage.style.display = 'block';
                }
            };
            
            // Initial load: show all events
            const sortedEvents = [...allEvents].sort((a, b) => {
                const nameA = a.name.toUpperCase();
                const nameB = b.name.toUpperCase();
                if (nameA < nameB) {
                    return -1;
                }
                if (nameA > nameB) {
                    return 1;
                }
                return 0;
            });
            displayEvents(sortedEvents);

            searchButton.addEventListener('click', () => {
                const inputQuery = keywordOrZipInput.value.trim();
                const selectedDate = eventDateInput.value;
                const selectedThemes = Array.from(themeSelect.options)
                                            .filter(option => option.selected && option.value !== '')
                                            .map(option => option.value);

                eventsDisplay.innerHTML = '';
                noResultsMessage.style.display = 'none';
                backToTopLink.style.display = 'none';

                let filteredEvents = allEvents;
                let hasCriteria = false;

                // Apply combined keyword or zip code filter
                if (inputQuery) {
                    if (/^\d{5}$/.test(inputQuery)) {
                        // It's a zip code
                        filteredEvents = filteredEvents.filter(event => {
                            return event.zipCode === inputQuery;
                        });
                    } else {
                        // It's a keyword
                        const lowerCaseQuery = inputQuery.toLowerCase();
                        filteredEvents = filteredEvents.filter(event => {
                            return event.name.toLowerCase().includes(lowerCaseQuery) ||
                                   event.location.toLowerCase().includes(lowerCaseQuery);
                        });
                    }
                    hasCriteria = true;
                }
                
                // Apply Date filter
                if (selectedDate) {
                    filteredEvents = filteredEvents.filter(event => {
                        if (!event.timestamp) {
                            return false;
                        }
                        const eventDateString = event.timestamp.toISOString().slice(0, 10);
                        return eventDateString === selectedDate;
                    });
                    hasCriteria = true;
                }

                // Apply Theme filter
                if (selectedThemes.length > 0) {
                    filteredEvents = filteredEvents.filter(event => {
                        return selectedThemes.every(theme => event.themes[theme]);
                    });
                    hasCriteria = true;
                }
                
                if (!hasCriteria) {
                    // If no search criteria are provided, show all events
                    const sortedEvents = [...allEvents].sort((a, b) => {
                        const nameA = a.name.toUpperCase();
                        const nameB = b.name.toUpperCase();
                        if (nameA < nameB) {
                            return -1;
                        }
                        if (nameA > nameB) {
                            return 1;
                        }
                        return 0;
                    });
                    displayEvents(sortedEvents);
                    return;
                }
                
                displayEvents(filteredEvents);
            });

            showAllEventsText.addEventListener('click', () => {
                keywordOrZipInput.value = '';
                eventDateInput.value = '';
                Array.from(themeSelect.options).forEach(option => option.selected = false);

                const sortedEvents = [...allEvents].sort((a, b) => {
                    const nameA = a.name.toUpperCase();
                    const nameB = b.name.toUpperCase();
                    if (nameA < nameB) {
                        return -1;
                    }
                    if (nameA > nameB) {
                        return 1;
                    }
                    return 0;
                });
                displayEvents(sortedEvents);
            });

            resetButton.addEventListener('click', () => {
                location.reload();
            });

            keywordOrZipInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    searchButton.click();
                }
            });

            backToTopLink.addEventListener('click', (event) => {
                event.preventDefault();
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        });
        // --- script.js content ends here ---
    </script>
</body>
</html>S
